#!/usr/bin/env perl
# Deduplicates a list of files generated by ./quickdupe

my $total_bytes_removed = 0;

while (<>) {
  chomp;
  my ($original, @duplicates) = split /\t/;
  for (@duplicates) {
    unlink             or die "failed to unlink duplicate $_: $!";
    link $original, $_ or die "failed to link $original to $_: $!";
  }

  my $size = -s $original;
  printf STDERR "relinked %s: removed %d duplicate(s), each %d bytes\n",
                $original,
                scalar(@duplicates),
                $size;
  $total_bytes_removed += $size * @duplicates;
}

printf STDERR "removed a total of %d bytes\n", $total_bytes_removed;

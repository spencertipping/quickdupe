#!/usr/bin/env perl
# Deduplicates a list of files generated by ./quickdupe

our $total_files_removed = 0;
our $total_bytes_removed = 0;

while (<>) {
  chomp;
  my ($original, @duplicates) = split /\t/;
  my $size = -s $original;

  for (@duplicates) {
    if (unlink and link $original, $_) {
      $total_bytes_removed += $size;
      ++$total_files_removed;
    } else {
      warn "failed to unlink/relink $original to $_";
    }
  }

  printf STDERR "\r\033[K%dk across %d file(s) removed",
                $total_bytes_removed / 1024,
                $total_files_removed;
}

print STDERR "\n";
